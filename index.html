<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High Score Health Point Tracker</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="icons/heart-plus.png">
</head>

<body>
    <div id="app" v-cloak>
        <!-- Login Screen -->
        <div v-if="!isAuthenticated && authChecked" class="login-container">
            <div class="login-box">
                <h1>High Score Health</h1>
                <h2>{{ isSignupMode ? 'Create Account' : 'Login' }}</h2>
                
                <div v-if="authError" class="auth-error">{{ authError }}</div>
                
                <form @submit.prevent="isSignupMode ? handleSignup() : handleLogin()">
                    <div v-if="isSignupMode" class="form-group">
                        <label for="displayName">Name</label>
                        <input 
                            type="text" 
                            id="displayName" 
                            v-model="displayName" 
                            required
                            placeholder="Hi, what's your name?"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input 
                            type="email" 
                            id="email" 
                            v-model="email" 
                            required
                            placeholder="Enter your email"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input 
                            type="password" 
                            id="password" 
                            v-model="password" 
                            required
                            placeholder="Enter your password"
                            minlength="6"
                        >
                    </div>
                    
                    <button type="submit" class="auth-button">
                        {{ isSignupMode ? 'Sign Up' : 'Login' }}
                    </button>
                </form>
                
                <p class="auth-toggle">
                    {{ isSignupMode ? 'Already have an account?' : "Don't have an account?" }}
                    <a href="#" @click.prevent="toggleAuthMode">
                        {{ isSignupMode ? 'Login' : 'Sign Up' }}
                    </a>
                </p>
            </div>
        </div>

        <!-- Main App -->
        <div v-if="isAuthenticated">
        <header>
            <div class="user-selector-container">
                <button @click="toggleUserMenu" class="user-menu-button">
                    Hi, {{ userDisplayName }}!
                </button>
                <div v-if="showUserMenu" class="user-dropdown">
                    <button @click="handleSignOut" class="user-menu-option">
                        Sign Out
                    </button>
                </div>
            </div>
        </header>
        <section class="hero">
            <div class="container">
                <div class="hero-text">Your Points</div>
                <div class="hero-counter">{{ headerTotal !== null ? headerTotal : '' }}</div>
            </div>
        </section>
        <!-- Tab links -->
        <div class="tab">
            <button class="tablinks" :class="{ active: activeTab === 'Earn' }" @click="openTab('Earn')">Earn</button>
            <button class="tablinks" :class="{ active: activeTab === 'Redeem' }" @click="openTab('Redeem')">Redeem</button>
            <button class="tablinks" :class="{ active: activeTab === 'Goals' }" @click="openTab('Goals')">Goals</button>
            <button class="tablinks" :class="{ active: activeTab === 'Achievements' }" @click="openTab('Achievements')">Achievements</button>
            <button class="tablinks" :class="{ active: activeTab === 'Tracking' }" @click="openTab('Tracking')">Tracking</button>
            <button class="tablinks" :class="{ active: activeTab === 'History' }" @click="openTab('History')">History</button>
        </div>

        <!-- Tab content -->
        <div v-show="activeTab === 'Earn'" class="tabcontent">
            <h3>Claim Points</h3>
            <div class="container toggle-container">
                <div class="toggle-group">
                    <label class="toggle-label">
                        <span>Indoor</span>
                        <label class="switch">
                            <input type="checkbox" v-model="showIndoor">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
                <div class="toggle-group">
                    <label class="toggle-label">
                        <span>Outdoor</span>
                        <label class="switch">
                            <input type="checkbox" v-model="showOutdoor">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
            </div>
            <div class="tile-grid">
                <div v-for="(widget, id) in filteredEarnData" :key="id" class="activity-tile" @click="earnPreset(id)">
                    <div class="tile-icon">
                        <!-- TODO: Eventually add icon file reference to each activity in Firebase and use that instead of default icon -->
                        <img src="icons/exercise_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.png" alt="Exercise icon">
                    </div>
                    <div class="tile-name">{{ widget.name }}</div>
                </div>
            </div>
            <!-- Fixed bottom container for custom entry -->
            <div class="fixed-bottom-container">
                <div class="custom-points-container">
                    <button class="custom-input-button" @click="customEntry" style="background-color: #4CAF50;">Custom Activity</button>
                </div>
            </div>
        </div>

        <div v-show="activeTab === 'Redeem'" class="tabcontent">
            <h3>Spend Points</h3>
            <div v-for="(widget, id) in redeemData" :key="id" class="widget" @click="redeemPreset(id)">
                <div class="title">{{ widget.name }}</div>
                <div class="value">{{ widget.pointValue }}</div>
            </div>
            <!-- Fixed bottom container for custom entry -->
            <div class="fixed-bottom-container">
                <div class="custom-points-container">
                    <button class="custom-input-button" @click="customEntry" style="background-color: #764ba2;">Custom Reward</button>
                </div>
            </div>
        </div>

        <div v-show="activeTab === 'Goals'" class="tabcontent">
            <h3>Reminders to save up points for upcoming events</h3>
            <p>Content coming soon</p>
        </div>

        <div v-show="activeTab === 'Achievements'" class="tabcontent">
            <h3>Achievements</h3>
            <p>Content coming soon</p>
        </div>

        <div v-show="activeTab === 'Tracking'" class="tabcontent">
            <h3>Tracking</h3>
            <div class="container">
                <div class="tracking-input-container">
                    <div class="tracking-input-group">
                        <select 
                            v-model="trackingMetric" 
                            class="tracking-metric-select"
                            id="tracking-metric"
                        >
                            <option value="weight">Weight</option>
                            <option value="waist">Waist</option>
                        </select>
                        <input 
                            type="number" 
                            id="tracking-input"
                            v-model.number="trackingInput"
                            step="0.1"
                            @keyup.enter="logTrackingData"
                        >
                        <button @click="logTrackingData" class="log-button">Log</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-show="activeTab === 'History'" class="tabcontent">
            <h3>Points Earned and Redeemed</h3>
            <div v-for="(widget, id) in historyData" :key="id" class="widget history-widget">
                <div class="history-memo">{{ widget.memo }}</div>
                <div class="history-points">{{ widget.pointsAdded }}</div>
                <div class="history-total">{{ widget.headerTotal }}</div>
            </div>
            <!-- Fixed bottom container for custom entry -->
            <div class="fixed-bottom-container">
                <div class="custom-points-container">
                    <button class="custom-input-button" @click="customEntry" style="background-color: #667eea;">Reset Point Total</button>
                </div>
            </div>
        </div>

        <!-- Activity Details Popup Modal -->
        <div v-if="showActivityModal" class="modal-overlay" @click="closeActivityModal">
            <div class="modal-content" @click.stop>
                <button class="modal-close" @click="closeActivityModal">&times;</button>
                <h2>{{ selectedActivity.name }}</h2>
                
                <div class="modal-section">
                    <h3>{{ selectedActivity.unit.charAt(0).toUpperCase() + selectedActivity.unit.slice(1) }}</h3>
                    <div class="unit-grid">
                        <div 
                            v-for="(points, quantity) in selectedActivity.pointsByUnit" 
                            :key="quantity"
                            class="unit-tile"
                            :class="{ selected: selectedQuantity == quantity }"
                            @click="selectQuantity(quantity)"
                        >
                            <div class="unit-amount">{{ quantity }}</div>
                        </div>
                    </div>
                </div>
                
                <div v-if="selectedActivity.intensityModifier" class="modal-section">
                    <h3>Intensity</h3>
                    <div class="intensity-slider-container">
                        <div class="intensity-labels">
                            <span>Easy</span>
                            <span>Moderate</span>
                            <span>Intense</span>
                        </div>
                        <input 
                            type="range" 
                            min="0" 
                            max="2" 
                            step="1" 
                            v-model.number="selectedIntensity"
                            class="intensity-slider"
                        >
                    </div>
                </div>
                
                <button 
                    class="claim-button"
                    :class="{ disabled: !selectedQuantity }"
                    :disabled="!selectedQuantity"
                    @click="claimActivityPoints"
                >
                    {{ selectedQuantity ? `Claim ${calculatedPoints} points!` : 'Please select the exercise amount' }}
                </button>
            </div>
        </div>

        <!-- Custom Entry Popup Modal -->
        <div v-if="showCustomEntryModal" class="modal-overlay" @click="closeCustomEntryModal">
            <div class="modal-content" @click.stop>
                <button class="modal-close" @click="closeCustomEntryModal">&times;</button>
                <h2>Custom {{ customEntryMode }}</h2>

                <div class="modal-section">
                    <h3>Points</h3>
                    <input 
                        type="number" 
                        v-model.number="customEntryPointValue"
                    >
                </div>

                <div class="modal-section">
                    <h3>Memo</h3>
                    <input 
                        type="text" 
                        v-model="customEntryMemo"
                    >
                </div>
                
                <div v-if="customEntryMode == 'Activity'" class="modal-section">
                    <button 
                        class="claim-button"
                        :class="{ disabled: !customEntryPointValue }"
                        :disabled="!customEntryPointValue"
                        @click="addCustomPoints"
                    >
                        {{ !customEntryPointValue ? 'Please enter a point value' : `Claim ${customEntryPointValue} points!` }}
                    </button>
                </div>
                <div v-else-if="customEntryMode == 'Reward'" class="modal-section">
                    <button 
                        class="claim-button"
                        :class="{ disabled: !customEntryPointValue }"
                        :disabled="!customEntryPointValue"
                        @click="subtractCustomPoints"
                    >
                        {{ !customEntryPointValue ? 'Please enter a point value' : `Redeem ${customEntryPointValue} points!` }}
                    </button>
                </div>
                <div v-else-if="customEntryMode == 'Reset'" class="modal-section">
                    <button 
                        class="claim-button"
                        :class="{ disabled: customEntryPointValue === null }"
                        :disabled="customEntryPointValue === null"
                        @click="resetPoints"
                    >
                        {{ customEntryPointValue === null ? 'Please enter a point value' : `Reset point total to ${customEntryPointValue}` }}
                    </button>
                </div>
                <div v-else class="modal-section">
                    <p>Unknown custom entry mode.</p>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script type="module" src="app.js"></script>
</body>

</html>